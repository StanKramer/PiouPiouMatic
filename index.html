<!-- PiouPiouMatic — Interface de diagnostic médical RP (vue de face, cumul des blessures, fond noir) -->
<!doctype html>
<html lang="fr">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>PiouPiouMatic — Interface de diagnostic médical RP</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
      body { background-color: #000; color: #fff; }
      .zone { cursor: pointer; transition: opacity 0.12s ease; }
      .zone:hover { opacity: 0.6; }
      .zone.selected { opacity: 0.8; }
      .svg-wrapper img { width: 280px; height: auto; margin: 0 auto; display: block; }
    </style>
  </head>
  <body>
    <div class="max-w-7xl mx-auto p-4">
      <header class="flex items-center justify-between mb-4">
        <h1 class="text-xl font-semibold text-white">PiouPiouMatic — Diagnostic médical RP</h1>
        <div class="text-sm text-gray-400">Vue de face • Cumul des blessures</div>
      </header>
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <div class="svg-wrapper relative">
          <img src="assets/body_unisex.png" alt="Corps humain unisexe" />
          <!-- zones cliquables positionnées en overlay -->
          <div id="clickLayer" class="absolute inset-0"></div>
        </div>
        <div id="diagnosticPanel" class="bg-gray-900 p-4 rounded-2xl shadow-lg overflow-y-auto max-h-[80vh]">
          <h2 class="text-lg font-semibold mb-2 text-white">Blessures enregistrées</h2>
          <div id="injuryList" class="space-y-3 text-gray-300"></div>
          <div class="mt-4 text-right">
            <button id="resetBtn" class="px-3 py-2 bg-red-600 rounded-lg hover:bg-red-700">Réinitialiser</button>
          </div>
        </div>
      </div>

      <!-- Boîte modale -->
      <div id="modal" class="fixed inset-0 bg-black bg-opacity-70 hidden items-center justify-center z-50">
        <div class="bg-gray-800 p-6 rounded-2xl shadow-xl max-w-sm w-full">
          <h3 class="text-lg font-semibold mb-2 text-white">Ajouter une blessure</h3>
          <div class="mb-3">
            <label class="block mb-1 text-gray-400">Type de blessure</label>
            <select id="injuryType" class="w-full bg-gray-900 border border-gray-600 rounded-lg p-2 text-white">
              <option>Arme à feu</option>
              <option>Arme blanche</option>
              <option>Contondante</option>
              <option>AVP</option>
              <option>Chute</option>
            </select>
          </div>
          <div class="mb-3">
            <label class="block mb-1 text-gray-400">Douleur (1 à 10)</label>
            <input id="painLevel" type="number" min="1" max="10" value="5" class="w-full bg-gray-900 border border-gray-600 rounded-lg p-2 text-white" />
          </div>
          <div class="flex justify-end space-x-2">
            <button id="cancelBtn" class="px-3 py-2 bg-gray-700 rounded-lg hover:bg-gray-600">Annuler</button>
            <button id="saveBtn" class="px-3 py-2 bg-green-600 rounded-lg hover:bg-green-700">Ajouter</button>
          </div>
        </div>
      </div>
    </div>

    <script>
      const clickLayer = document.getElementById('clickLayer');
      const modal = document.getElementById('modal');
      const saveBtn = document.getElementById('saveBtn');
      const cancelBtn = document.getElementById('cancelBtn');
      const injuryList = document.getElementById('injuryList');
      const painInput = document.getElementById('painLevel');
      const typeSelect = document.getElementById('injuryType');
      const resetBtn = document.getElementById('resetBtn');

      const injuries = [];
      const zones = [
        { id: 'tete', name: 'Tête', top: '5%', left: '45%', width: '10%', height: '10%' },
        { id: 'torse', name: 'Torse', top: '18%', left: '42%', width: '16%', height: '18%' },
        { id: 'bras_g', name: 'Bras gauche', top: '20%', left: '30%', width: '10%', height: '18%' },
        { id: 'bras_d', name: 'Bras droit', top: '20%', left: '60%', width: '10%', height: '18%' },
        { id: 'jambe_g', name: 'Jambe gauche', top: '45%', left: '45%', width: '8%', height: '25%' },
        { id: 'jambe_d', name: 'Jambe droite', top: '45%', left: '52%', width: '8%', height: '25%' },
      ];

      zones.forEach(z => {
        const div = document.createElement('div');
        div.className = 'zone absolute';
        div.style.top = z.top;
        div.style.left = z.left;
        div.style.width = z.width;
        div.style.height = z.height;
        div.addEventListener('click', () => openModal(z));
        clickLayer.appendChild(div);
      });

      let currentZone = null;

      function openModal(zone) {
        currentZone = zone;
        modal.classList.remove('hidden');
        modal.classList.add('flex');
      }

      cancelBtn.addEventListener('click', () => {
        modal.classList.add('hidden');
        modal.classList.remove('flex');
      });

      saveBtn.addEventListener('click', () => {
        const type = typeSelect.value;
        const pain = parseInt(painInput.value);
        if (!currentZone) return;
        const treatment = generateTreatment(type);
        injuries.push({ zone: currentZone.name, type, pain, treatment });
        updateList();
        modal.classList.add('hidden');
        modal.classList.remove('flex');
      });

      function updateList() {
        injuryList.innerHTML = '';
        const grouped = {};
        injuries.forEach(i => {
          if (!grouped[i.zone]) grouped[i.zone] = [];
          grouped[i.zone].push(i);
        });
        for (const zone in grouped) {
          const div = document.createElement('div');
          div.innerHTML = `<h3 class='font-semibold text-white mb-1'>${zone}</h3>`;
          grouped[zone].forEach((i, idx) => {
            const p = document.createElement('div');
            p.className = 'text-sm flex justify-between bg-gray-800 rounded-lg px-2 py-1 mb-1';
            p.innerHTML = `<span>${i.type} (douleur ${i.pain}) — ${i.treatment}</span><button class='text-red-400 hover:text-red-300' data-zone='${zone}' data-idx='${idx}'>×</button>`;
            div.appendChild(p);
          });
          injuryList.appendChild(div);
        }
        document.querySelectorAll('#injuryList button').forEach(btn => {
          btn.addEventListener('click', e => {
            const zone = e.target.dataset.zone;
            const idx = parseInt(e.target.dataset.idx);
            injuries.splice(injuries.findIndex(i => i.zone === zone && grouped[zone].indexOf(i) === idx), 1);
            updateList();
          });
        });
      }

      function generateTreatment(type) {
        switch (type) {
          case 'Arme à feu': return 'Pansement compressif + surveillance hémorragique';
          case 'Arme blanche': return 'Suture + désinfection locale';
          case 'Contondante': return 'Glace + immobilisation + anti-douleur';
          case 'AVP': return 'Surveillance trauma + immobilisation';
          case 'Chute': return 'Repos + glace + contrôle radio';
          default: return 'Soins locaux';
        }
      }

      resetBtn.addEventListener('click', () => {
        injuries.length = 0;
        updateList();
      });
    </script>
  </body>
</html>
