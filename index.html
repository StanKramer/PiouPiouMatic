<!-- PiouPiouMatic — Interface de diagnostic médical RP
     - Image PNG unisexe (remplacez `assets/body_unisex.png` par votre image PNG)
     - Pas d'historique, pas d'import/export
     - Clic sur une zone ouvre une boîte modale pour ajouter une blessure
     - Les blessures s'incrémentent automatiquement dans la colonne de droite,
       groupées par partie du corps, avec traitement simplifié
-->
<!doctype html>
<html lang="fr">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>PiouPiouMatic — Diagnostic médical RP</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
      .zone { cursor: pointer; }
      .zone-hover { fill: rgba(99,102,241,0.12); }
      .zone-selected { fill: rgba(239,68,68,0.18); }
      .body-wrap{max-width:680px}
      /* Ensure overlay sits on the image */
      .overlay { position:absolute; left:0; top:0; pointer-events:none; }
      .hotspot { pointer-events:auto; }
    </style>
  </head>
  <body class="bg-gray-50 text-gray-800">
    <div class="max-w-6xl mx-auto p-6">
      <header class="flex items-center justify-between mb-6">
        <h1 class="text-2xl font-semibold">PiouPiouMatic — Diagnostic médical RP</h1>
        <div class="text-sm text-gray-500">Vue de face • Image PNG unisexe • Sans historique</div>
      </header>

      <main class="grid grid-cols-1 md:grid-cols-3 gap-6">
        <!-- Left: image + overlay hotspots -->
        <section class="md:col-span-1 bg-white p-4 rounded-lg shadow">
          <h2 class="font-medium mb-2">Carte du corps (clique une zone)</h2>

          <div class="relative body-wrap mx-auto" style="width:320px;">
            <!-- Replace the src with your PNG unisexe (recommended size: ~320x800 or adjust viewBox) -->
            <img id="bodyImg" src="assets/body_unisex.png" alt="Corps unisexe" class="w-full rounded" />

            <!-- SVG overlay (transparent) — coordinates approximate the image above. Keep pointer-events none on svg, but hotspots set pointer-events:auto -->
            <svg id="overlay" class="overlay" viewBox="0 0 200 520" width="100%" height="260%" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
              <!-- hotspots (invisible shapes) with class hotspot -->
              <ellipse id="head" class="hotspot" cx="100" cy="40" rx="30" ry="28" fill="transparent" stroke="transparent" />
              <rect id="neck" class="hotspot" x="86" y="65" width="28" height="12" fill="transparent" stroke="transparent" />
              <path id="chest" class="hotspot" d="M60 85 C60 85,48 150,60 210 C60 260,140 260,140 210 C152 150,140 85,140 85 Z" fill="transparent" stroke="transparent" />
              <rect id="abdomen" class="hotspot" x="72" y="210" width="56" height="70" fill="transparent" stroke="transparent" />
              <ellipse id="pelvis" class="hotspot" cx="100" cy="300" rx="26" ry="14" fill="transparent" stroke="transparent" />
              <path id="left_arm" class="hotspot" d="M60 110 C20 120,10 180,40 230 L54 218 C40 190,58 150,60 110 Z" fill="transparent" stroke="transparent" />
              <path id="right_arm" class="hotspot" d="M140 110 C180 120,190 180,160 230 L146 218 C160 190,142 150,140 110 Z" fill="transparent" stroke="transparent" />
              <path id="left_leg" class="hotspot" d="M86 280 L86 420 C86 460,110 500,96 500 C80 500,70 470,70 440 L70 300 Z" fill="transparent" stroke="transparent" />
              <path id="right_leg" class="hotspot" d="M114 280 L114 420 C114 460,90 500,104 500 C120 500,130 470,130 440 L130 300 Z" fill="transparent" stroke="transparent" />
            </svg>

          </div>

        </section>

        <!-- Middle: modal controls -->
        <section class="md:col-span-1 bg-white p-4 rounded-lg shadow">
          <h2 class="font-medium mb-2">Ajout de blessure</h2>
          <p class="text-sm text-gray-600 mb-3">Clique sur une partie du corps pour ouvrir la boîte d'ajout.</p>

          <div id="lastAction" class="text-sm text-gray-500">Aucune action récente.</div>

          <div class="mt-4">
            <button id="resetBtn" class="bg-gray-200 px-3 py-2 rounded">Réinitialiser blessures</button>
          </div>
        </section>

        <!-- Right: injuries grouped by part + treatments -->
        <aside class="md:col-span-1 bg-white p-4 rounded-lg shadow">
          <h2 class="font-medium mb-2">Blessures enregistrées</h2>
          <div id="injuryList" class="text-sm text-gray-700 space-y-3">
            <p class="text-gray-500">Aucune blessure pour le moment.</p>
          </div>
        </aside>
      </main>

      <footer class="mt-6 text-center text-xs text-gray-500">PiouPiouMatic — Outil RP (remplacez l'image PNG dans /assets/)</footer>
    </div>

    <!-- Modal (hidden) -->
    <div id="modal" class="fixed inset-0 bg-black bg-opacity-40 hidden items-center justify-center z-50">
      <div class="bg-white rounded-lg w-11/12 max-w-md p-4">
        <h3 id="modalTitle" class="text-lg font-medium">Ajouter une blessure</h3>
        <p id="modalPart" class="text-sm text-gray-500">Partie: --</p>

        <div class="mt-3">
          <label class="block text-sm font-medium">Type de blessure</label>
          <select id="modalInjuryType" class="w-full border rounded p-2">
            <option value="arme_feu">Blessure par arme à feu</option>
            <option value="arme_blanche">Blessure par arme blanche</option>
            <option value="contondante">Traumatisme contondant</option>
            <option value="avp">Accident de la voie publique (AVP)</option>
            <option value="chute">Chute</option>
          </select>
        </div>

        <div class="mt-3">
          <label class="block text-sm font-medium">Douleur (1–10)</label>
          <input id="modalPain" type="range" min="1" max="10" value="5" class="w-full" />
          <div class="text-xs text-gray-500 mt-1">Valeur: <span id="modalPainLabel">5</span>/10</div>
        </div>

        <div class="mt-4 flex gap-2 justify-end">
          <button id="modalCancel" class="px-3 py-2 rounded border">Annuler</button>
          <button id="modalAdd" class="px-3 py-2 rounded bg-indigo-600 text-white">Ajouter</button>
        </div>
      </div>
    </div>

    <script>
      // Zones and labels
      const ZONES = ['head','neck','chest','abdomen','pelvis','left_arm','right_arm','left_leg','right_leg'];
      const ZONE_LABEL = {head:'Tête',neck:'Cou',chest:'Thorax',abdomen:'Abdomen',pelvis:'Bassin',left_arm:'Bras gauche',right_arm:'Bras droit',left_leg:'Jambe gauche',right_leg:'Jambe droite'};

      // Data: injuries stored in-memory; grouped by zone
      const injuriesByZone = {}; ZONES.forEach(z=>injuriesByZone[z]=[]);

      // Treatment suggestions (simplified)
      const TREATMENT = {
        arme_feu: 'Pansement compressif, contrôle de l’hémorragie; transport urgent.',
        arme_blanche: 'Désinfection, compression locale; surveillance et exploration si pénétrante.',
        contondante: 'Glace, immobilisation, analgésie simple; vérifier fractures.',
        avp: 'Immobilisation, analgesie, recherche de polytraumatisme; transport.',
        chute: 'Immobilisation, examen pour fracture/commotion; surveillance.'
      };

      // Hook hotspots
      const overlay = document.getElementById('overlay');
      ZONES.forEach(id=>{
        const el = document.getElementById(id);
        if(!el) return;
        el.addEventListener('click', (ev)=>{
          ev.stopPropagation();
          openModalForZone(id);
        });
        // hover effect: briefly highlight part (we draw a translucent path on top)
        el.addEventListener('mouseenter', ()=>{el.setAttribute('fill','rgba(99,102,241,0.12)');});
        el.addEventListener('mouseleave', ()=>{el.setAttribute('fill','transparent');});
      });

      // Modal controls
      const modal = document.getElementById('modal');
      const modalTitle = document.getElementById('modalTitle');
      const modalPart = document.getElementById('modalPart');
      const modalInjuryType = document.getElementById('modalInjuryType');
      const modalPain = document.getElementById('modalPain');
      const modalPainLabel = document.getElementById('modalPainLabel');
      let currentZone = null;

      modalPain.addEventListener('input', ()=>{ modalPainLabel.textContent = modalPain.value; });

      function openModalForZone(zone){
        currentZone = zone;
        modalTitle.textContent = 'Ajouter une blessure — ' + (ZONE_LABEL[zone]||zone);
        modalPart.textContent = 'Partie: ' + (ZONE_LABEL[zone]||zone);
        modalInjuryType.value = 'arme_feu';
        modalPain.value = 5; modalPainLabel.textContent = 5;
        modal.classList.remove('hidden'); modal.classList.add('flex');
      }

      document.getElementById('modalCancel').addEventListener('click', ()=>{ closeModal(); });
      function closeModal(){ modal.classList.remove('flex'); modal.classList.add('hidden'); currentZone = null; }

      document.getElementById('modalAdd').addEventListener('click', ()=>{
        if(!currentZone) return closeModal();
        const type = modalInjuryType.value;
        const pain = parseInt(modalPain.value,10);
        const timestamp = new Date().toISOString();
        const entry = {id: Date.now(), zone: currentZone, zoneLabel: ZONE_LABEL[currentZone], type, pain, treatment: TREATMENT[type], addedAt: timestamp};
        injuriesByZone[currentZone].push(entry);
        document.getElementById('lastAction').textContent = `Blessure ajoutée: ${entry.zoneLabel} — ${type.replace('_',' ')} (${entry.pain}/10)`;
        closeModal(); renderInjuries();
      });

      // Reset button
      document.getElementById('resetBtn').addEventListener('click', ()=>{
        if(!confirm('Supprimer toutes les blessures ?')) return;
        ZONES.forEach(z=>injuriesByZone[z]=[]); renderInjuries();
        document.getElementById('lastAction').textContent = 'Blessures réinitialisées.';
      });

      // Render right column grouped by zone
      function renderInjuries(){
        const container = document.getElementById('injuryList');
        container.innerHTML = '';
        const partsWith = ZONES.filter(z=>injuriesByZone[z].length>0);
        if(partsWith.length===0){ container.innerHTML = '<p class="text-gray-500">Aucune blessure pour le moment.</p>'; return; }
        partsWith.forEach(zone=>{
          const card = document.createElement('div');
          card.className = 'border p-2 rounded';
          const title = document.createElement('div'); title.className='font-medium'; title.textContent = `${ZONE_LABEL[zone]} — ${injuriesByZone[zone].length} blessure(s)`;
          card.appendChild(title);

          // list injuries
          injuriesByZone[zone].forEach((inj, idx)=>{
            const row = document.createElement('div'); row.className='mt-2 text-sm';
            row.innerHTML = `<div class="flex justify-between items-start"><div><strong>${idx+1}.</strong> ${inj.type.replace('_',' ')} — douleur ${inj.pain}/10</div><div><button data-zone="${zone}" data-id="${inj.id}" class="text-xs px-2 py-1 border rounded remove-btn">Suppr</button></div></div><div class="text-xs mt-1 text-gray-600">Traitement: ${inj.treatment}</div>`;
            card.appendChild(row);
          });

          container.appendChild(card);
        });

        // attach remove handlers
        document.querySelectorAll('.remove-btn').forEach(btn=>{
          btn.addEventListener('click', (ev)=>{
            const zone = btn.getAttribute('data-zone');
            const id = parseInt(btn.getAttribute('data-id'),10);
            injuriesByZone[zone] = injuriesByZone[zone].filter(i=>i.id!==id);
            renderInjuries();
            document.getElementById('lastAction').textContent = 'Blessure supprimée.';
          });
        });
      }

      // Click outside modal closes it
      modal.addEventListener('click', (ev)=>{ if(ev.target===modal) closeModal(); });

      // Init
      renderInjuries();

      // Accessibility: allow keyboard escape to close modal
      document.addEventListener('keydown', (e)=>{ if(e.key === 'Escape'){ if(!modal.classList.contains('hidden')) closeModal(); } });
    </script>
  </body>
</html>
